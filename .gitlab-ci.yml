stages:
  - build
  - staging
  - promote

build:
  stage: build
  script:
    - sudo apt-get update
    - sudo apt-get install -y curl
    - rm -Rf docker-odoo-base/
    - curl -L https://github.com/docker/compose/releases/download/1.19.0/docker-compose-`uname -s`-`uname -m` -o /usr/local/bin/docker-compose
    - chmod +x /usr/local/bin/docker-compose
    - git clone -b scaffolding http://gitlab.imio.be:10080/odoo/docker-odoo-base.git
    - cd docker-odoo-base
    - docker-compose -f prod.yaml build --no-cache

staging:
  stage: staging
  script:
    - docker tag dockerodoobase_odoo docker-staging.imio.be/extraschool-v9
    - docker push docker-staging.imio.be/extraschool-v9:latest

promote:
  stage: promote
  script:
    - docker tag dockerodoobase_odoo docker-prod.imio.be/extraschool-v9
    - docker push docker-prod.imio.be/extraschool-v9:latest
  when: manual
